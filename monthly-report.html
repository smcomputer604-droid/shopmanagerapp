<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monthly Sales Report - SM PRINT TECHNOLOGY</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap">
    <link rel="stylesheet" href="style.css">
    <style>
        /* Monthly report specific styles */
        .report-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 90px 20px 40px;
        }
        
        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 1000;
        }
        
        .month-selector {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .month-input-container {
            flex: 1;
            min-width: 200px;
        }
        
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .summary-card {
            padding: 25px;
            text-align: center;
        }
        
        .summary-icon {
            font-size: 40px;
            margin-bottom: 15px;
        }
        
        .summary-value {
            font-size: 32px;
            font-weight: 700;
            margin: 10px 0;
        }
        
        .summary-label {
            font-size: 16px;
            color: var(--text-secondary);
        }
        
        .chart-container {
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            border-radius: var(--border-radius);
            padding: 30px;
            margin: 30px 0;
            min-height: 400px;
            position: relative;
        }
        
        .daily-sales-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .daily-sales-table th {
            background: linear-gradient(to right, var(--primary-color), var(--primary-light));
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }
        
        .daily-sales-table td {
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .daily-sales-table tr:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .month-total {
            background: linear-gradient(135deg, rgba(155, 89, 182, 0.2), rgba(142, 68, 173, 0.1));
            border-left: 5px solid #9b59b6;
            padding: 25px;
            border-radius: var(--border-radius);
            margin-top: 30px;
        }
        
        .no-data {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }
        
        .no-data i {
            font-size: 60px;
            margin-bottom: 20px;
            color: var(--text-light);
        }
        
        .loading {
            text-align: center;
            padding: 40px;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(67, 97, 238, 0.2);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .day-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            margin: 5px 0;
            transition: all 0.3s ease;
        }
        
        .day-card:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }
        
        .day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .day-date {
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .day-amount {
            font-weight: 700;
            color: #2ecc71;
            font-size: 18px;
        }
        
        .day-details {
            font-size: 12px;
            color: var(--text-secondary);
            display: flex;
            justify-content: space-between;
        }
        
        .calendar-view {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-top: 30px;
        }
        
        .calendar-day {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            min-height: 80px;
            position: relative;
        }
        
        .calendar-day.empty {
            background: transparent;
        }
        
        .calendar-day.has-sales {
            background: linear-gradient(135deg, rgba(46, 204, 113, 0.2), rgba(39, 174, 96, 0.1));
            border: 1px solid rgba(46, 204, 113, 0.3);
            cursor: pointer;
        }
        
        .calendar-day.has-sales:hover {
            transform: scale(1.05);
        }
        
        .day-number {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .day-sales {
            font-size: 12px;
            color: #2ecc71;
            font-weight: 600;
        }
        
        .weekday-header {
            text-align: center;
            font-size: 12px;
            color: var(--text-secondary);
            padding: 10px;
            font-weight: 600;
        }
        
        @media (max-width: 768px) {
            .calendar-view {
                grid-template-columns: repeat(7, 1fr);
                gap: 5px;
            }
            
            .calendar-day {
                min-height: 60px;
                padding: 5px;
            }
        }
    </style>
    <!-- Chart.js for graphs -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Back Button -->
    <button class="back-button glass-card" onclick="goBack()">
        <i class="fas fa-arrow-left"></i> Back to ShopFlow
    </button>

    <!-- Report Container -->
    <div class="report-container">
        <!-- Header -->
        <div class="section-title">
            <h1>Monthly Sales Report</h1>
            <p>View monthly sales trends and statistics</p>
        </div>
        
        <!-- Month Selection -->
        <div class="glass-card form-container">
            <div class="month-selector">
                <div class="month-input-container">
                    <label class="form-label" for="reportMonth">Select Month & Year</label>
                    <input type="month" id="reportMonth" class="form-input" value="">
                </div>
                <button class="btn btn-primary" id="loadReportBtn">
                    <i class="fas fa-chart-bar"></i> Generate Report
                </button>
                <button class="btn btn-secondary" id="currentMonthBtn">
                    <i class="fas fa-calendar-alt"></i> Current Month
                </button>
                <button class="btn btn-secondary" id="prevMonthBtn">
                    <i class="fas fa-chevron-left"></i> Previous Month
                </button>
            </div>
        </div>
        
        <!-- Loading -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <div>Loading monthly report...</div>
        </div>
        
        <!-- No Data Message -->
        <div class="no-data glass-card" id="noData" style="display: none;">
            <i class="fas fa-chart-bar"></i>
            <h3>No Sales Data Found</h3>
            <p>No sales recorded for the selected month.</p>
        </div>
        
        <!-- Report Content -->
        <div id="reportContent" style="display: none;">
            <!-- Summary Cards -->
            <div class="summary-cards">
                <div class="summary-card glass-card">
                    <div class="summary-icon" style="color: #3498db;">
                        <i class="fas fa-calendar-check"></i>
                    </div>
                    <div class="summary-value" id="monthName">January 2024</div>
                    <div class="summary-label">Selected Month</div>
                </div>
                
                <div class="summary-card glass-card">
                    <div class="summary-icon" style="color: #2ecc71;">
                        <i class="fas fa-money-bill-wave"></i>
                    </div>
                    <div class="summary-value" id="monthlyTotal">à§³0</div>
                    <div class="summary-label">Monthly Sales</div>
                </div>
                
                <div class="summary-card glass-card">
                    <div class="summary-icon" style="color: #9b59b6;">
                        <i class="fas fa-calendar-day"></i>
                    </div>
                    <div class="summary-value" id="daysWithSales">0</div>
                    <div class="summary-label">Business Days</div>
                </div>
                
                <div class="summary-card glass-card">
                    <div class="summary-icon" style="color: #f39c12;">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="summary-value" id="dailyAverage">à§³0</div>
                    <div class="summary-label">Daily Average</div>
                </div>
            </div>
            
            <!-- Calendar View -->
            <div class="section-title">
                <h2>Monthly Calendar View</h2>
                <p>Click on any day to view detailed report</p>
            </div>
            
            <div class="glass-card">
                <div id="calendarView" class="calendar-view">
                    <!-- Calendar will be generated here -->
                </div>
            </div>
            
            <!-- Daily Breakdown -->
            <div class="section-title" style="margin-top: 50px;">
                <h2>Daily Breakdown</h2>
                <p>Sales breakdown by day</p>
            </div>
            
            <div id="dailyBreakdown">
                <!-- Daily cards will be inserted here -->
            </div>
            
            <!-- Service Performance -->
            <div class="section-title" style="margin-top: 50px;">
                <h2>Service Performance</h2>
                <p>Top performing services of the month</p>
            </div>
            
            <div class="glass-card">
                <canvas id="serviceChart" height="100"></canvas>
            </div>
            
            <!-- Monthly Total -->
            <div class="month-total glass-card">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <div style="font-size: 14px; color: var(--text-secondary);">Monthly Total for</div>
                        <div style="font-size: 24px; font-weight: 700;" id="monthDisplay"></div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 14px; color: var(--text-secondary);">Total Monthly Sales</div>
                        <div style="font-size: 42px; font-weight: 800; color: #9b59b6;" id="monthGrandTotal">à§³0</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>
    
    <!-- Script -->
    <script>
        // Configuration
        const CONFIG = {
            APP_NAME: 'ShopFlow Monthly Reports',
            GOOGLE_SHEETS_URL: localStorage.getItem('shopflow_google_sheets_url') || ''
        };
        
        // DOM Elements
        let reportMonth, loadReportBtn, currentMonthBtn, prevMonthBtn;
        let loading, noData, reportContent;
        let calendarView, dailyBreakdown, serviceChart;
        let monthNameEl, monthlyTotalEl, daysWithSalesEl, dailyAverageEl;
        let monthDisplay, monthGrandTotal;
        let toastContainer;
        let chartInstance = null;
        
        // Initialize
        function init() {
            console.log('ðŸ“ˆ Initializing Monthly Report');
            
            // Get DOM elements
            getDOMElements();
            
            // Setup event listeners
            setupEventListeners();
            
            // Set current month by default
            setCurrentMonth();
            
            // Load current month's report automatically
            setTimeout(() => {
                loadReportBtn.click();
            }, 500);
        }
        
        function getDOMElements() {
            reportMonth = document.getElementById('reportMonth');
            loadReportBtn = document.getElementById('loadReportBtn');
            currentMonthBtn = document.getElementById('currentMonthBtn');
            prevMonthBtn = document.getElementById('prevMonthBtn');
            loading = document.getElementById('loading');
            noData = document.getElementById('noData');
            reportContent = document.getElementById('reportContent');
            calendarView = document.getElementById('calendarView');
            dailyBreakdown = document.getElementById('dailyBreakdown');
            serviceChart = document.getElementById('serviceChart');
            monthNameEl = document.getElementById('monthName');
            monthlyTotalEl = document.getElementById('monthlyTotal');
            daysWithSalesEl = document.getElementById('daysWithSales');
            dailyAverageEl = document.getElementById('dailyAverage');
            monthDisplay = document.getElementById('monthDisplay');
            monthGrandTotal = document.getElementById('monthGrandTotal');
            toastContainer = document.getElementById('toastContainer');
        }
        
        function setupEventListeners() {
            loadReportBtn.onclick = generateMonthlyReport;
            currentMonthBtn.onclick = setCurrentMonth;
            prevMonthBtn.onclick = setPreviousMonth;
        }
        
        function setCurrentMonth() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            reportMonth.value = `${year}-${month}`;
            generateMonthlyReport();
        }
        
        function setPreviousMonth() {
            const date = new Date();
            date.setMonth(date.getMonth() - 1);
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            reportMonth.value = `${year}-${month}`;
            generateMonthlyReport();
        }
        
        async function generateMonthlyReport() {
            const monthYear = reportMonth.value;
            
            if (!monthYear) {
                showToast('Please select a month', 'error');
                return;
            }
            
            const [year, month] = monthYear.split('-');
            
            // Show loading, hide other sections
            loading.style.display = 'block';
            noData.style.display = 'none';
            reportContent.style.display = 'none';
            
            try {
                let reportData;
                
                if (CONFIG.GOOGLE_SHEETS_URL) {
                    // Try to get from Google Sheets
                    reportData = await getMonthlyReportFromGoogleSheets(year, month);
                    
                    if (!reportData || reportData.error) {
                        // Fallback to localStorage
                        reportData = getMonthlyReportFromLocalStorage(year, month);
                    }
                } else {
                    // Use localStorage
                    reportData = getMonthlyReportFromLocalStorage(year, month);
                }
                
                // Display the report
                displayMonthlyReport(year, month, reportData);
                
            } catch (error) {
                console.error('Error generating monthly report:', error);
                showToast('Error loading report: ' + error.message, 'error');
                
                // Show no data
                loading.style.display = 'none';
                noData.style.display = 'block';
            }
        }
        
        async function getMonthlyReportFromGoogleSheets(year, month) {
            if (!CONFIG.GOOGLE_SHEETS_URL) return null;
            
            try {
                const params = new URLSearchParams({
                    method: 'getMonthlyReport',
                    year: year,
                    month: month
                });
                
                const response = await fetch(`${CONFIG.GOOGLE_SHEETS_URL}?${params}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                return data;
                
            } catch (error) {
                console.error('Google Sheets error:', error);
                return null;
            }
        }
        
        function getMonthlyReportFromLocalStorage(year, month) {
            // Get sales from localStorage
            const sales = JSON.parse(localStorage.getItem('shopflow_sales') || '[]');
            
            // Filter sales for the selected month
            const monthSales = sales.filter(sale => {
                const saleDate = new Date(sale.date);
                return saleDate.getFullYear() == year && 
                       (saleDate.getMonth() + 1) == month;
            });
            
            if (monthSales.length === 0) {
                return { 
                    success: false, 
                    message: 'No sales found for selected month',
                    sales: []
                };
            }
            
            // Group sales by day
            const dailySales = {};
            const serviceSales = {};
            
            monthSales.forEach(sale => {
                const day = new Date(sale.date).getDate();
                const service = sale.service;
                const amount = parseFloat(sale.amount);
                
                // Group by day
                if (!dailySales[day]) {
                    dailySales[day] = {
                        date: sale.date,
                        total: 0,
                        count: 0,
                        services: {}
                    };
                }
                dailySales[day].total += amount;
                dailySales[day].count++;
                
                // Group by service for the day
                if (!dailySales[day].services[service]) {
                    dailySales[day].services[service] = {
                        total: 0,
                        count: 0
                    };
                }
                dailySales[day].services[service].total += amount;
                dailySales[day].services[service].count++;
                
                // Group by service for the month
                if (!serviceSales[service]) {
                    serviceSales[service] = {
                        total: 0,
                        count: 0
                    };
                }
                serviceSales[service].total += amount;
                serviceSales[service].count++;
            });
            
            // Calculate monthly totals
            const monthlyTotal = Object.values(dailySales).reduce((sum, day) => sum + day.total, 0);
            const daysWithSales = Object.keys(dailySales).length;
            const dailyAverage = monthlyTotal / daysWithSales;
            
            // Get month name
            const monthNames = [
                'January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'
            ];
            const monthName = monthNames[parseInt(month) - 1];
            
            // Convert service sales to array and sort by total
            const serviceArray = Object.entries(serviceSales).map(([service, data]) => ({
                service,
                ...data
            })).sort((a, b) => b.total - a.total);
            
            return {
                success: true,
                year: year,
                month: month,
                monthName: monthName,
                monthlyTotal: monthlyTotal,
                daysWithSales: daysWithSales,
                dailyAverage: dailyAverage,
                dailySales: dailySales,
                serviceSales: serviceArray,
                allSales: monthSales
            };
        }
        
        function displayMonthlyReport(year, month, reportData) {
            loading.style.display = 'none';
            
            if (!reportData || !reportData.success || reportData.daysWithSales === 0) {
                noData.style.display = 'block';
                return;
            }
            
            // Update summary cards
            monthNameEl.textContent = `${reportData.monthName} ${year}`;
            monthlyTotalEl.textContent = 'à§³' + formatNumber(reportData.monthlyTotal);
            daysWithSalesEl.textContent = reportData.daysWithSales;
            dailyAverageEl.textContent = 'à§³' + formatNumber(reportData.dailyAverage);
            
            // Update month display
            monthDisplay.textContent = `${reportData.monthName} ${year}`;
            monthGrandTotal.textContent = 'à§³' + formatNumber(reportData.monthlyTotal);
            
            // Generate calendar
            generateCalendar(year, month, reportData.dailySales);
            
            // Generate daily breakdown
            generateDailyBreakdown(reportData.dailySales);
            
            // Generate service chart
            generateServiceChart(reportData.serviceSales);
            
            // Show content
            reportContent.style.display = 'block';
            
            console.log('Monthly report generated for:', `${year}-${month}`, reportData);
        }
        
        function generateCalendar(year, month, dailySales) {
            // Get first day of month and number of days
            const firstDay = new Date(year, month - 1, 1);
            const lastDay = new Date(year, month, 0);
            const daysInMonth = lastDay.getDate();
            const startingDay = firstDay.getDay(); // 0 = Sunday, 1 = Monday, etc.
            
            // Clear previous calendar
            calendarView.innerHTML = '';
            
            // Add weekday headers
            const weekdays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            weekdays.forEach(day => {
                const dayEl = document.createElement('div');
                dayEl.className = 'weekday-header';
                dayEl.textContent = day;
                calendarView.appendChild(dayEl);
            });
            
            // Add empty cells for days before the first day of month
            for (let i = 0; i < startingDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day empty';
                calendarView.appendChild(emptyDay);
            }
            
            // Add days of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const dayEl = document.createElement('div');
                const hasSales = dailySales[day];
                
                dayEl.className = `calendar-day ${hasSales ? 'has-sales' : ''}`;
                
                if (hasSales) {
                    dayEl.onclick = () => viewDayReport(year, month, day);
                    dayEl.title = `Click to view ${day}/${month}/${year} report`;
                }
                
                dayEl.innerHTML = `
                    <div class="day-number">${day}</div>
                    ${hasSales ? 
                        `<div class="day-sales">à§³${formatNumber(dailySales[day].total)}</div>
                         <div style="font-size: 10px; color: #3498db;">${dailySales[day].count} sales</div>` 
                        : ''
                    }
                `;
                
                calendarView.appendChild(dayEl);
            }
        }
        
        function generateDailyBreakdown(dailySales) {
            // Convert to array and sort by date
            const dailyArray = Object.entries(dailySales)
                .map(([day, data]) => ({ day: parseInt(day), ...data }))
                .sort((a, b) => b.day - a.day); // Newest first
            
            let html = '';
            
            dailyArray.forEach(dayData => {
                // Format date
                const date = new Date(dayData.date);
                const formattedDate = date.toLocaleDateString('en-IN', {
                    weekday: 'long',
                    day: 'numeric',
                    month: 'short',
                    year: 'numeric'
                });
                
                // Get top 3 services for the day
                const services = Object.entries(dayData.services || {})
                    .map(([service, data]) => ({ service, ...data }))
                    .sort((a, b) => b.total - a.total)
                    .slice(0, 3);
                
                html += `
                    <div class="day-card glass-card">
                        <div class="day-header">
                            <div class="day-date">${formattedDate}</div>
                            <div class="day-amount">à§³${formatNumber(dayData.total)}</div>
                        </div>
                        <div class="day-details">
                            <div>
                                <i class="fas fa-receipt"></i> ${dayData.count} transactions
                            </div>
                            <div>
                                <i class="fas fa-tags"></i> ${Object.keys(dayData.services || {}).length} services
                            </div>
                            <div>
                                <button class="btn-small" onclick="viewDayReport(${date.getFullYear()}, ${date.getMonth() + 1}, ${date.getDate()})">
                                    <i class="fas fa-eye"></i> View Details
                                </button>
                            </div>
                        </div>
                        ${services.length > 0 ? `
                            <div style="margin-top: 10px; padding-top: 10px; border-top: 1px dashed rgba(255,255,255,0.1);">
                                <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 5px;">Top Services:</div>
                                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                    ${services.map(s => `
                                        <span style="background: rgba(67, 97, 238, 0.1); padding: 3px 8px; border-radius: 12px; font-size: 11px;">
                                            ${s.service}: à§³${formatNumber(s.total)}
                                        </span>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                `;
            });
            
            dailyBreakdown.innerHTML = html;
            
            // Add CSS for small button
            const style = document.createElement('style');
            style.textContent = `
                .btn-small {
                    background: rgba(67, 97, 238, 0.1);
                    color: var(--primary-color);
                    border: none;
                    padding: 4px 12px;
                    border-radius: 4px;
                    font-size: 11px;
                    cursor: pointer;
                }
                .btn-small:hover {
                    background: rgba(67, 97, 238, 0.2);
                }
            `;
            document.head.appendChild(style);
        }
        
        function generateServiceChart(serviceSales) {
            // Destroy previous chart if exists
            if (chartInstance) {
                chartInstance.destroy();
            }
            
            // Get top 10 services
            const topServices = serviceSales.slice(0, 10);
            const labels = topServices.map(s => s.service);
            const data = topServices.map(s => s.total);
            const colors = generateColors(topServices.length);
            
            const ctx = serviceChart.getContext('2d');
            chartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Sales Amount (à§³)',
                        data: data,
                        backgroundColor: colors,
                        borderColor: colors.map(c => c.replace('0.8', '1')),
                        borderWidth: 1,
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `à§³${formatNumber(context.parsed.y)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'à§³' + formatNumber(value);
                                }
                            }
                        },
                        x: {
                            ticks: {
                                maxRotation: 45,
                                minRotation: 45
                            }
                        }
                    }
                }
            });
        }
        
        function generateColors(count) {
            const colors = [
                'rgba(67, 97, 238, 0.8)',
                'rgba(46, 204, 113, 0.8)',
                'rgba(241, 196, 15, 0.8)',
                'rgba(231, 76, 60, 0.8)',
                'rgba(155, 89, 182, 0.8)',
                'rgba(52, 152, 219, 0.8)',
                'rgba(230, 126, 34, 0.8)',
                'rgba(26, 188, 156, 0.8)',
                'rgba(149, 165, 166, 0.8)',
                'rgba(22, 160, 133, 0.8)'
            ];
            
            return colors.slice(0, count);
        }
        
        function viewDayReport(year, month, day) {
            const dateStr = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            
            // Open daily report in new tab with the date pre-selected
            const url = `daily-report.html?date=${dateStr}`;
            window.open(url, '_blank');
        }
        
        function formatNumber(num) {
            return parseFloat(num).toLocaleString('en-IN', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        }
        
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icons = {
                success: 'fa-check-circle',
                error: 'fa-exclamation-circle',
                warning: 'fa-exclamation-triangle',
                info: 'fa-info-circle'
            };
            
            toast.innerHTML = `
                <i class="fas ${icons[type] || 'fa-info-circle'} toast-icon"></i>
                <span class="toast-message">${message}</span>
            `;
            
            toastContainer.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.add('show');
            }, 10);
            
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 400);
            }, 5000);
            
            return toast;
        }
        
        function goBack() {
            window.location.href = 'index.html';
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>